.card.shadow
  .card-header.bg-primary.text-white
    %h2.mb-0= "#{@division.event.name} - #{@division.name}"

  .card-body
    .row
      .col-md-6
        %p
          %strong Event:
          = link_to @division.event.name, public_event_path(@division.event)

        %p
          %strong Age Range:
          = "#{@division.min_age} ‚Äì #{@division.max_age} years"

        %p
          %strong Weight Range:
          = "#{@division.min_weight} ‚Äì #{@division.max_weight} kg"

      .col-md-6
        %p
          %strong Belt:
          %span.badge.bg-secondary= @division.belt

        %p
          %strong Sex:
          %span.badge.bg-info= @division.sex

    .mt-3
      = link_to "‚Üê Back to Event", public_event_path(@division.event), class: "btn btn-secondary"

-# Registered Athletes Section
.mt-4
  .card
    .card-header
      %h4.mb-0
        %i.fa.fa-users.me-2
        Registered Athletes
        %span.badge.bg-primary.ms-2= @registered_athletes.count
    .card-body
      - if @registered_athletes.any?
        .table-responsive
          %table.table.table-hover.table-striped
            %thead
              %tr
                %th Name
                %th Team
                %th Belt
                %th Weight
            %tbody
              - @registered_athletes.each do |athlete|
                %tr
                  %td
                    %strong= athlete.fullname
                  %td= athlete.team.name
                  %td
                    %span.badge.bg-secondary= athlete.belt
                  %td= "#{athlete.weight} kg"
      - else
        .alert.alert-info.mb-0
          %i.fa.fa-info-circle.me-2
          No athletes registered yet.

-# Tournament Bracket Section
- if @bouts_by_round.present?
  .mt-5
    .card
      .card-header.bg-success.text-white
        %h3.mb-0
          %i.fa.fa-trophy.me-2
          Tournament Bracket
  
      .card-body
        - normal_bouts = @bouts_by_round.reject { |round, bouts| bouts.any? { |b| ["final", "consolation", "champion"].include?(b.bout_type) } }
        - final_bout = @division.bouts.find_by(bout_type: "final")
        - consolation_bout = @division.bouts.find_by(bout_type: "consolation")
        - champion_bout = @division.bouts.find_by(bout_type: "champion")
  
        .bracket-container
          - normal_bouts.each do |round, bouts|
            .round-column
              %h5.mb-3.text-center.text-primary
                - total_normal_rounds = normal_bouts.keys.max
                - rounds_before_final = total_normal_rounds - round
                
                - if rounds_before_final == 0
                  Semi-Finals
                - elsif rounds_before_final == 1
                  Quarter-Finals
                - elsif round == 1
                  Round 1
                - else
                  Round #{round}
              
              - bouts.each do |bout|
                .match-box.mb-3
                  .slot.athlete-slot{ class: (bout.winner_id == bout.athlete_a_id && bout.winner_id.present? && bout.athlete_a_id.present?) ? "winner-slot" : "" }
                    - if bout.athlete_a
                      .athlete-name.fw-bold= bout.athlete_a.fullname
                      %small.team-name.text-muted= bout.athlete_a.team.name
                    - else
                      .text-muted.fst-italic TBD
                  
                  .vs-divider.text-center.my-2
                    %small.text-muted.fw-bold vs
                  
                  .slot.athlete-slot{ class: (bout.winner_id == bout.athlete_b_id && bout.winner_id.present? && bout.athlete_b_id.present?) ? "winner-slot" : "" }
                    - if bout.athlete_b
                      .athlete-name.fw-bold= bout.athlete_b.fullname
                      %small.team-name.text-muted= bout.athlete_b.team.name
                    - else
                      .text-muted.fst-italic TBD
                  
                  - if bout.winner
                    .winner-badge.mt-2.text-center
                      %span.badge.bg-success
                        %i.fa.fa-trophy.me-1
                        Winner: #{bout.winner.fullname}
                  - elsif bout.athlete_a && bout.athlete_b
                    .pending-badge.mt-2.text-center
                      %span.badge.bg-warning.text-dark
                        %i.fa.fa-clock.me-1
                        Match Pending
          
          -# Finals Column
          - if final_bout && consolation_bout
            .round-column
              %h5.mb-3.text-center.text-danger Finals
              
              -# Championship Final
              .match-box.mb-4.border-primary{ style: "border: 3px solid #0d6efd;" }
                .text-center.mb-2
                  %h6.text-primary
                    %i.fa.fa-trophy.me-1
                    Championship Final
                
                .slot.athlete-slot{ class: (final_bout.winner_id == final_bout.athlete_a_id && final_bout.winner_id.present? && final_bout.athlete_a_id.present?) ? "winner-slot" : "" }
                  - if final_bout.athlete_a
                    .athlete-name.fw-bold= final_bout.athlete_a.fullname
                    %small.team-name.text-muted= final_bout.athlete_a.team.name
                  - else
                    .text-muted.fst-italic TBD
                
                .vs-divider.text-center.my-2
                  %small.text-muted.fw-bold vs
                
                .slot.athlete-slot{ class: (final_bout.winner_id == final_bout.athlete_b_id && final_bout.winner_id.present? && final_bout.athlete_b_id.present?) ? "winner-slot" : "" }
                  - if final_bout.athlete_b
                    .athlete-name.fw-bold= final_bout.athlete_b.fullname
                    %small.team-name.text-muted= final_bout.athlete_b.team.name
                  - else
                    .text-muted.fst-italic TBD
                
                - if final_bout.winner
                  .winner-badge.mt-2.text-center
                    %span.badge.bg-success
                      %i.fa.fa-trophy.me-1
                      Winner: #{final_bout.winner.fullname}
                - elsif final_bout.athlete_a && final_bout.athlete_b
                  .pending-badge.mt-2.text-center
                    %span.badge.bg-warning.text-dark
                      %i.fa.fa-clock.me-1
                      Match Pending
              
              -# Consolation Final
              .match-box.border-warning{ style: "border: 2px solid #ffc107;" }
                .text-center.mb-2
                  %h6.text-warning
                    %i.fa.fa-medal.me-1
                    3rd Place Match
                
                .slot.athlete-slot{ class: (consolation_bout.winner_id == consolation_bout.athlete_a_id && consolation_bout.winner_id.present?) ? "winner-slot" : "" }
                  - if consolation_bout.athlete_a
                    .athlete-name.fw-bold= consolation_bout.athlete_a.fullname
                    %small.team-name.text-muted= consolation_bout.athlete_a.team.name
                  - else
                    .text-muted.fst-italic TBD
                
                .vs-divider.text-center.my-2
                  %small.text-muted.fw-bold vs
                
                .slot.athlete-slot{ class: (consolation_bout.winner_id == consolation_bout.athlete_b_id && consolation_bout.winner_id.present?) ? "winner-slot" : "" }
                  - if consolation_bout.athlete_b
                    .athlete-name.fw-bold= consolation_bout.athlete_b.fullname
                    %small.team-name.text-muted= consolation_bout.athlete_b.team.name
                  - else
                    .text-muted.fst-italic TBD
                
                - if consolation_bout.winner
                  .winner-badge.mt-2.text-center
                    %span.badge.bg-success
                      %i.fa.fa-trophy.me-1
                      Winner: #{consolation_bout.winner.fullname}
                - elsif consolation_bout.athlete_a && consolation_bout.athlete_b
                  .pending-badge.mt-2.text-center
                    %span.badge.bg-warning.text-dark
                      %i.fa.fa-clock.me-1
                      Match Pending
          
          -# Champions Podium
          - if champion_bout && (champion_bout.athlete_a || champion_bout.loser || champion_bout.athlete_b)
            .round-column
              %h5.mb-3.text-center.text-success
                %i.fa.fa-trophy.me-2
                Final Results
              
              .champions-podium
                -# 1st Place - Gold
                - if champion_bout.athlete_a
                  .podium-place.gold.mb-4.p-4.text-center.rounded{ style: "background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%); border: 3px solid #d4af37;" }
                    %i.fa.fa-trophy.fa-3x.mb-3{ style: "color: #d4af37;" }
                    %h4.mb-2
                      %span.badge.text-dark{ style: "background-color: #ffd700; font-size: 1.2rem;" } ü•á 1st Place
                    %h5.fw-bold= champion_bout.athlete_a.fullname
                    %p.text-muted.mb-0= champion_bout.athlete_a.team.name
                
                -# 2nd Place - Silver
                - if champion_bout.loser
                  .podium-place.silver.mb-4.p-4.text-center.rounded{ style: "background: linear-gradient(135deg, #c0c0c0 0%, #e8e8e8 100%); border: 3px solid #999;" }
                    %i.fa.fa-medal.fa-2x.mb-3{ style: "color: #888;" }
                    %h5.mb-2
                      %span.badge.text-dark{ style: "background-color: #c0c0c0; font-size: 1.1rem;" } ü•à 2nd Place
                    %h6.fw-bold= champion_bout.loser.fullname
                    %p.text-muted.mb-0.small= champion_bout.loser.team.name
                
                -# 3rd Place - Bronze
                - if champion_bout.athlete_b
                  .podium-place.bronze.p-4.text-center.rounded{ style: "background: linear-gradient(135deg, #cd7f32 0%, #e6a75d 100%); border: 3px solid #8b4513;" }
                    %i.fa.fa-medal.fa-2x.mb-3{ style: "color: #8b4513;" }
                    %h5.mb-2
                      %span.badge.text-white{ style: "background-color: #cd7f32; font-size: 1.1rem;" } ü•â 3rd Place
                    %h6.fw-bold.text-white= champion_bout.athlete_b.fullname
                    %p.text-white-50.mb-0.small= champion_bout.athlete_b.team.name

- else
  .mt-5
    .alert.alert-info.d-flex.align-items-center
      %i.fa.fa-info-circle.fa-2x.me-3
      .flex-grow-1
        %h5.alert-heading No Bracket Generated Yet
        %p.mb-0 The tournament bracket has not been created yet. Please check back later.

